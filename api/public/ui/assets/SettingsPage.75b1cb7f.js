import{d as $,o as f,c as E,w as r,e,as as g,I as C,J as w,at as F,af as D,r as V,h as Q,ah as B,cq as h,K as v,cr as _,aA as N,Q as k,aC as A,aq as R,ai as b,au as T,al as S,am as z,cx as O,cz as j,av as I,cy as K}from"./index.4424682c.js";import{Q as M}from"./QPagination.3ab32847.js";import{Q as G}from"./QPage.bb2e11f4.js";import{Q as H}from"./QSelect.4d475f4f.js";import{Q as J}from"./QForm.da968091.js";import{i as L}from"./index.6f2cfc2b.js";import{u as q}from"./notification.7df50ca5.js";import"./format.a33550d6.js";import"./QChip.121929ac.js";import"./selection.d915aaaa.js";import"./rtl.b51694b1.js";import"./router.1445b5b4.js";const W={class:"text-h6"},X={class:"text-subtitle2"},Y=$({__name:"UserWidget",props:{data:null},setup(m){return(p,s)=>(f(),E(F,null,{default:r(()=>[e(g,null,{default:r(()=>{var n;return[C("div",W,w(m.data.name)+" ("+w((n=m.data.role)==null?void 0:n.toLocaleUpperCase())+") ",1),C("div",X,w(m.data.phone),1)]}),_:1})]),_:1}))}}),Z={class:"text-h6 text-center"},ee=$({__name:"UserForm",props:{update:null},emits:["completed","destroy"],setup(m,{emit:p}){const s=m,n=["admin","manager","supervisor"],y=L(D),a=V({name:"",password:"",password_confirmation:"",phone:"",role:"supervisor"}),c=Q(()=>Boolean(s.update));async function x(){if(a.value.password!==a.value.password_confirmation)A.create({message:"Las contrase\xF1as no coinciden",color:"negative"});else try{let d;c.value&&s.update?d=(await y.update(s.update.id,a.value)).data:d=(await y.store(a.value)).data,p("completed",d)}catch(d){q.axiosError(d)}}return B(()=>{s.update&&(a.value={name:s.update.name,password:"",password_confirmation:"",phone:s.update.phone,role:"supervisor"})}),(d,o)=>(f(),E(F,null,{default:r(()=>[e(J,{onSubmit:h(x,["prevent"])},{default:r(()=>[e(g,null,{default:r(()=>[C("div",Z,w(v(c)?"Actualizar":"Crear")+" Usuario ",1)]),_:1}),e(g,{class:"q-gutter-y-sm"},{default:r(()=>[e(_,{modelValue:a.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value.name=l),type:"text",label:"Nombre",required:""},null,8,["modelValue"]),e(_,{modelValue:a.value.phone,"onUpdate:modelValue":o[1]||(o[1]=l=>a.value.phone=l),type:"tel",label:"Telefono",readonly:v(c),required:""},null,8,["modelValue","readonly"]),e(H,{modelValue:a.value.role,"onUpdate:modelValue":o[2]||(o[2]=l=>a.value.role=l),options:n,label:"Rol"},null,8,["modelValue"]),e(_,{modelValue:a.value.password,"onUpdate:modelValue":o[3]||(o[3]=l=>a.value.password=l),type:"password",label:"Contrase\xF1a",required:""},null,8,["modelValue"]),e(_,{modelValue:a.value.password_confirmation,"onUpdate:modelValue":o[4]||(o[4]=l=>a.value.password_confirmation=l),type:"password",label:"Repita Contrase\xF1a",required:""},null,8,["modelValue"])]),_:1}),e(N,null,{default:r(()=>[e(k,{color:"primary",icon:"mdi-check",label:"Guardar",type:"submit"}),e(k,{color:"negative",icon:"mdi-delete",label:"Eliminar",onClick:o[5]||(o[5]=l=>p("destroy",m.update))})]),_:1})]),_:1},8,["onSubmit"])]),_:1}))}}),ae={class:"row q-col-gutter-sm"},ve=$({__name:"SettingsPage",setup(m){const p=L(D),s=V(!1),n=V({data:[],links:{},meta:{current_page:0}}),y=Q(()=>n.value.meta.last_page?Number(n.value.meta.last_page):n.value.meta.current_page),a=V(),c=Q(()=>n.value.data);function x(u){a.value=u||void 0,s.value=!0}async function d(u){await U(u),O()}async function o(u){if(u.id===1){A.create({message:`No se puede eliminar el usuario ${u.name} porque es un usuario protegido`,color:"negative"});return}j.create({title:"Eliminar Usuario",message:`Desea eliminar el usuario ${u.name}`,ok:"Eliminar",cancel:"Cancelar"}).onOk(async()=>{try{await p.destroy(u.id),l()}catch(t){q.axiosError(t)}})}function l(){s.value=!1,a.value=void 0,U()}async function U(u=1){try{n.value=(await p.list(u)).data}catch(t){q.axiosError(t)}}return B(async()=>{R("Ajustes"),await U()}),(u,t)=>(f(),b(S,null,[e(G,{padding:""},{default:r(()=>[e(F,{class:"no-box-shadow"},{default:r(()=>[e(g,null,{default:r(()=>[e(k,{icon:"mdi-plus",label:"A\xF1adir Usuario",class:"full-width",color:"primary",onClick:t[0]||(t[0]=i=>x(void 0))})]),_:1})]),_:1}),e(g,{class:"q-px-none"},{default:r(()=>[C("div",ae,[(f(!0),b(S,null,z(v(c),(i,P)=>(f(),b("div",{class:I(v(K)),key:`user-${i.id}-${P}`},[e(Y,{data:i,onClick:oe=>x(i)},null,8,["data","onClick"])],2))),128))])]),_:1}),e(N,{class:"q-pa-lg flex flex-center"},{default:r(()=>[e(M,{modelValue:n.value.meta.current_page,"onUpdate:modelValue":[t[1]||(t[1]=i=>n.value.meta.current_page=i),t[2]||(t[2]=i=>d(i))],max:v(y),input:""},null,8,["modelValue","max"])]),_:1})]),_:1}),e(T,{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=i=>s.value=i)},{default:r(()=>[e(ee,{class:"dialog-form",update:a.value,onCompleted:l,onDestroy:t[3]||(t[3]=i=>o(i))},null,8,["update"])]),_:1},8,["modelValue"])],64))}});export{ve as default};
