import{d as V,az as A,o as n,e as _,w as m,at as N,f as s,ai as x,am as O,al as Q,as as v,u as e,c as w,J as b,K as E,ay as D,Q as $,L as C,aJ as L,r as h,ah as R,aq as T,R as M,O as U,aA as K,aK as z,av as F,aL as J,aM as j}from"./index.04fb470e.js";import{Q as H}from"./QPagination.36b8f6b7.js";import{Q as W}from"./QPage.35b7a6ff.js";import{i as G}from"./index.6925d095.js";import{Q as k}from"./QChip.2f03b717.js";import{_ as I}from"./OrderOfferWidget.2264d2bf.js";import{u as q}from"./notification.bcef4808.js";import"./format.3e32b8d9.js";import"./router.1722d853.js";const X=V({__name:"OrderSelection",props:{modelValue:null},emits:["update:model-value"],setup(g,{emit:d}){const p=g,a=[{icon:"mdi-cart-plus",label:"Nuevos",status:"created"},{icon:"mdi-check",label:"Aceptados",status:"accepted"},{icon:"mdi-cancel",label:"Denegado",status:"r-canceled"},{icon:"mdi-receipt-text-check-outline",label:"Completado",status:"completed"}],{modelValue:t}=A(p);function c(u){d("update:model-value",u)}return(u,f)=>(n(),_(N,{class:"no-box-shadow"},{default:m(()=>[s(v,null,{default:m(()=>[(n(),x(Q,null,O(a,(r,y)=>s(k,{key:`chip-${y}`,clickable:"",class:"glossy",icon:r.icon,label:r.label,onClick:S=>c(r),color:e(t).status===r.status?"primary":"","text-color":e(t).status===r.status?"white":""},null,8,["icon","label","onClick","color","text-color"])),64))]),_:1})]),_:1}))}}),Y={class:"absolute-top-left q-pa-xs"},Z={class:"absolute-top-right q-pa-xs"},ee={class:"text-body1"},te={class:"text-subtitle"},ae=V({__name:"OrderWidget",props:{order:null,editable:{type:Boolean}},emits:["change-status"],setup(g,{emit:d}){const p=g,{order:a}=A(p),t=w(()=>{switch(a.value.status){case"r-canceled":return{icon:"mdi-cancel",text:"Denegado",color:"negative",text_color:"white"};case"accepted":return{icon:"mdi-check",text:"Aceptado",color:"info",text_color:"dark"};case"c-canceled":return{icon:"mdi-cancel",text:"Cancelado",color:"negative",text_color:"white"};case"completed":return{icon:"mdi-check-all",text:"Completado",color:"positive",text_color:"white"};default:return{icon:"mdi-clock",text:"En Proceso",color:"",text_color:"dark"}}});return(c,u)=>(n(),_(N,null,{default:m(()=>[s(v,null,{default:m(()=>[b("div",Y,[s(k,{class:"glossy",label:`#${e(a).id}`},null,8,["label"])]),b("div",Z,[s(k,{label:`Mesa ${e(a).table_number}`},null,8,["label"]),s(k,{class:"glossy",label:e(t).text,icon:e(t).icon,color:e(t).color,"text-color":e(t).text_color},null,8,["label","icon","color","text-color"])])]),_:1}),s(v,null,{default:m(()=>[(n(!0),x(Q,null,O(e(a).order_products,(f,r)=>(n(),x("div",{key:`order-offer-${e(a).id}-${r}`,class:"mt-sm"},[s(I,{data:f,details:""},null,8,["data"])]))),128))]),_:1}),s(v,null,{default:m(()=>[b("div",ee,"Total: "+E(e(D)(e(a).total_price)),1),b("div",te,"Creado por: "+E(e(a).user.name),1)]),_:1}),g.editable?(n(),_(v,{key:0},{default:m(()=>[e(a).status==="created"?(n(),_($,{key:0,color:"primary",dense:"",label:"Aceptar",onClick:u[0]||(u[0]=f=>d("change-status","accepted"))})):C("",!0),e(a).status==="accepted"||e(a).status==="created"?(n(),_($,{key:1,color:"negative",dense:"",label:"Cancelar",onClick:u[1]||(u[1]=f=>d("change-status","r-canceled"))})):C("",!0),e(a).status==="accepted"?(n(),_($,{key:2,color:"positive",dense:"",label:"Completar",onClick:u[2]||(u[2]=f=>d("change-status","completed"))})):C("",!0)]),_:1})):C("",!0)]),_:1}))}}),le={class:"row q-col-gutter-sm"},pe=V({__name:"OrdersPage",setup(g){const d=G(U),p=L(),a=h(!1),t=h({icon:"mdi-check",label:"Todos",status:"all"}),c=h({data:[],links:{},meta:{current_page:0}}),u=w(()=>c.value.data),f=w(()=>c.value.meta.last_page?Number(c.value.meta.last_page):c.value.meta.current_page);async function r(i,l){try{i==="all"?c.value=(await d.list({page:l})).data:c.value=(await d.filter({status:i,page:l})).data}catch(o){q.axiosError(o)}}function y(i){let l="Aceptado";i.status==="r-canceled"?l="Cancelado":i.status==="completed"&&(l="Completado"),j.create({title:"Cambio de estado",message:`Va a cambiar el estado de la orden #${i.order.id} a ${l.toLocaleUpperCase()}`,ok:"Cambiar Estado",cancel:"No Cambiar"}).onOk(async()=>{try{await d.update(i.order.id,i.status),await r(t.value.status),d.count()}catch(o){q.axiosError(o)}})}async function S(i){await r(t.value.status,i),z()}return R(async()=>{T("Pedidos"),p.name===M.ORDERS&&(a.value=!0),p.query.status?t.value.status=p.query.status:t.value.status="created",await r(t.value.status)}),(i,l)=>(n(),_(W,{padding:""},{default:m(()=>[s(X,{modelValue:t.value,"onUpdate:modelValue":[l[0]||(l[0]=o=>t.value=o),l[1]||(l[1]=o=>{t.value=o,r(t.value.status)})]},null,8,["modelValue"]),s(v,{class:"q-px-none"},{default:m(()=>[b("div",le,[(n(!0),x(Q,null,O(e(u),(o,B)=>(n(),x("div",{class:F(e(J)),key:`order-${o.id}-${B}`},[s(ae,{order:o,editable:a.value,onChangeStatus:P=>y({status:P,order:o})},null,8,["order","editable","onChangeStatus"])],2))),128))])]),_:1}),s(K,{class:"q-pa-lg flex flex-center"},{default:m(()=>[s(H,{modelValue:c.value.meta.current_page,"onUpdate:modelValue":[l[2]||(l[2]=o=>c.value.meta.current_page=o),l[3]||(l[3]=o=>S(o))],max:e(f),input:""},null,8,["modelValue","max"])]),_:1})]),_:1}))}});export{pe as default};
