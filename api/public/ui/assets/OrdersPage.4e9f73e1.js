import{d as w,az as q,o as c,c as f,w as d,at as A,e as s,ai as g,am as V,al as Q,as as _,K as a,h,I as b,J as B,ay as E,Q as y,L as $,cw as T,r as O,ah as D,aq as L,O as U,aA as z,cx as M,av as F,cy as K,cz as R}from"./index.4424682c.js";import{Q as j}from"./QPagination.3ab32847.js";import{Q as H}from"./QPage.bb2e11f4.js";import{i as I}from"./index.6f2cfc2b.js";import{Q as C}from"./QChip.121929ac.js";import{_ as J}from"./OrderOfferWidget.b4ef0f8d.js";import{u as S}from"./notification.7df50ca5.js";import"./format.a33550d6.js";import"./router.1445b5b4.js";const W=w({__name:"OrderSelection",props:{modelValue:null},emits:["update:model-value"],setup(v,{emit:u}){const p=v,e=[{icon:"mdi-expand-all-outline",label:"Todos",status:"all"},{icon:"mdi-cart-plus",label:"Nuevos",status:"created"},{icon:"mdi-check",label:"Aceptados",status:"accepted"},{icon:"mdi-account-cancel",label:"Cancelado",status:"c-canceled"},{icon:"mdi-cancel",label:"Denegado",status:"r-canceled"},{icon:"mdi-receipt-text-check-outline",label:"Completado",status:"completed"}],{modelValue:t}=q(p);function x(n){u("update:model-value",n)}return(n,i)=>(c(),f(A,{class:"no-box-shadow"},{default:d(()=>[s(_,null,{default:d(()=>[(c(),g(Q,null,V(e,(m,k)=>s(C,{key:`chip-${k}`,clickable:"",class:"glossy",icon:m.icon,label:m.label,onClick:r=>x(m),color:a(t).status===m.status?"primary":"","text-color":a(t).status===m.status?"white":""},null,8,["icon","label","onClick","color","text-color"])),64))]),_:1})]),_:1}))}}),G={class:"absolute-top-left q-pa-xs"},X={class:"absolute-top-right q-pa-xs"},Y={class:"text-body1"},Z=w({__name:"OrderWidget",props:{order:null},emits:["change-status"],setup(v,{emit:u}){const p=v,{order:e}=q(p),t=h(()=>{switch(e.value.status){case"r-canceled":return{icon:"mdi-cancel",text:"Denegado",color:"negative",text_color:"white"};case"accepted":return{icon:"mdi-check",text:"Aceptado",color:"info",text_color:"dark"};case"c-canceled":return{icon:"mdi-cancel",text:"Cancelado",color:"negative",text_color:"white"};case"completed":return{icon:"mdi-check-all",text:"Completado",color:"positive",text_color:"white"};default:return{icon:"mdi-clock",text:"En Proceso",color:"",text_color:"dark"}}});return(x,n)=>(c(),f(A,null,{default:d(()=>[s(_,null,{default:d(()=>[b("div",G,[s(C,{class:"glossy",label:`#${a(e).id}`},null,8,["label"])]),b("div",X,[s(C,{label:`Mesa ${a(e).table_number}`},null,8,["label"]),s(C,{class:"glossy",label:a(t).text,icon:a(t).icon,color:a(t).color,"text-color":a(t).text_color},null,8,["label","icon","color","text-color"])])]),_:1}),s(_,null,{default:d(()=>[(c(!0),g(Q,null,V(a(e).order_products,(i,m)=>(c(),g("div",{key:`order-offer-${a(e).id}-${m}`,class:"mt-sm"},[s(J,{data:i,details:""},null,8,["data"])]))),128))]),_:1}),s(_,null,{default:d(()=>[b("div",Y,"Total: "+B(a(E)(a(e).total_price)),1)]),_:1}),s(_,null,{default:d(()=>[a(e).status==="created"?(c(),f(y,{key:0,color:"primary",dense:"",label:"Aceptar",onClick:n[0]||(n[0]=i=>u("change-status","accepted"))})):$("",!0),a(e).status==="accepted"||a(e).status==="created"?(c(),f(y,{key:1,color:"negative",dense:"",label:"Cancelar",onClick:n[1]||(n[1]=i=>u("change-status","r-canceled"))})):$("",!0),a(e).status==="accepted"?(c(),f(y,{key:2,color:"positive",dense:"",label:"Completar",onClick:n[2]||(n[2]=i=>u("change-status","completed"))})):$("",!0)]),_:1})]),_:1}))}}),ee={class:"row q-col-gutter-sm"},ie=w({__name:"OrdersPage",setup(v){const u=I(U),p=T(),e=O({icon:"mdi-check",label:"Todos",status:"all"}),t=O({data:[],links:{},meta:{current_page:0}}),x=h(()=>t.value.data),n=h(()=>t.value.meta.last_page?Number(t.value.meta.last_page):t.value.meta.current_page);async function i(r,l){try{r==="all"?t.value=(await u.list({page:l})).data:t.value=(await u.filter({status:r,page:l})).data}catch(o){S.axiosError(o)}}function m(r){let l="Aceptado";r.status==="r-canceled"?l="Cancelado":r.status==="completed"&&(l="Completado"),R.create({title:"Cambio de estado",message:`Va a cambiar el estado de la orden #${r.order.id} a ${l.toLocaleUpperCase()}`,ok:"Cambiar Estado",cancel:"No Cambiar"}).onOk(async()=>{try{await u.update(r.order.id,r.status),await i(e.value.status),u.count()}catch(o){S.axiosError(o)}})}async function k(r){await i(e.value.status,r),M()}return D(async()=>{L("Pedidos"),p.query.status&&(e.value.status=p.query.status),await i(e.value.status)}),(r,l)=>(c(),f(H,{padding:""},{default:d(()=>[s(W,{modelValue:e.value,"onUpdate:modelValue":[l[0]||(l[0]=o=>e.value=o),l[1]||(l[1]=o=>{e.value=o,i(e.value.status)})]},null,8,["modelValue"]),s(_,{class:"q-px-none"},{default:d(()=>[b("div",ee,[(c(!0),g(Q,null,V(a(x),(o,N)=>(c(),g("div",{class:F(a(K)),key:`order-${o.id}-${N}`},[s(Z,{order:o,onChangeStatus:P=>m({status:P,order:o})},null,8,["order","onChangeStatus"])],2))),128))])]),_:1}),s(z,{class:"q-pa-lg flex flex-center"},{default:d(()=>[s(j,{modelValue:t.value.meta.current_page,"onUpdate:modelValue":[l[2]||(l[2]=o=>t.value.meta.current_page=o),l[3]||(l[3]=o=>k(o))],max:a(n),input:""},null,8,["modelValue","max"])]),_:1})]),_:1}))}});export{ie as default};
